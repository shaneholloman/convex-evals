# Run Analysis: claude-haiku-4-5 (no_guidelines)

- **Run ID**: jn7ajdrrv895kr0er1zryse19d80n9rq
- **Model**: claude-haiku-4-5 (anthropic)
- **Experiment**: no_guidelines
- **Date**: 2026-02-06
- **Pass rate**: 38/66 (57.6%)
- **Duration**: 535s

## Failure Summary

| Step | Count |
|------|-------|
| deploy (convex dev) | 20 |
| tests | 6 |
| eslint | 1 |

## Per-Failure Analysis

### 1. 002-basic_http_endpoint (000-fundamentals) -- deploy

**Classification**: MODEL_FAULT

Used `new HttpRouter()` (class constructor) instead of `httpRouter()` (factory function), and `pathPrefix` instead of `path` for exact-match routes.

```typescript
// Model (wrong):
import { HttpRouter } from "convex/server";
const http = new HttpRouter();
http.route({ pathPrefix: "/api/hello", method: "GET", ... });

// Expected:
import { httpRouter } from "convex/server";
const http = httpRouter();
http.route({ path: "/api/hello", method: "GET", ... });
```

---

### 2. 003-crons (000-fundamentals) -- deploy

**Classification**: MODEL_FAULT

Put cron definitions in wrong file (`convex/convex.cron.ts` instead of `convex/crons.ts`). Separate from the opus issue (which was about the missing 4th arg) — Haiku doesn't even know the correct file naming convention.

---

### 3. 005-function_calling (000-fundamentals) -- deploy

**Classification**: MODEL_FAULT

Deploy failure, likely syntax or import error in generated code.

---

### 4. 008-helper_fns (000-fundamentals) -- deploy

**Classification**: MODEL_FAULT

Per GAPS.txt, model put code in separate `items` and `helpers` files instead of all in `index.ts`, and didn't perform the database fetch inside the helper function.

---

### 5. 009-returns_validator (000-fundamentals) -- deploy

**Classification**: KNOWN_GAP

Missing `as const` on discriminated union return objects. Documented in GAPS.txt.

---

### 6. 006-literals (001-data_modeling) -- deploy

**Classification**: MODEL_FAULT

Deploy failure, likely syntax or structural issue.

---

### 7. 007-schema_evolution (001-data_modeling) -- deploy

**Classification**: MODEL_FAULT

Case-sensitivity error: used `"./_generated/datamodel"` (lowercase) instead of `"./_generated/dataModel"` (camelCase).

```typescript
// Model (wrong):
import { Doc, Id } from "./_generated/datamodel";

// Expected:
import { Doc, Id } from "./_generated/dataModel";
```

---

### 8. 010-discriminated_union (001-data_modeling) -- tests (0%)

**Classification**: MODEL_FAULT

Wrapped union inside `defineTable({ kind: v.union(...) })` instead of making the union the table validator itself with `defineTable(v.union(...))`.

```typescript
// Model (wrong):
notifications: defineTable({ kind: v.union(v.object({...}), ...) })

// Expected:
notifications: defineTable(v.union(v.object({...}), ...))
```

---

### 9. 004-range_condition (002-queries) -- deploy

**Classification**: MODEL_FAULT

Used `.filter()` after `.gte()` instead of chaining `.lte()` on the index query for the upper bound.

```typescript
// Model (wrong):
.withIndex("by_sensor_time", (q) => q.eq("sensorId", args.sensorId).gte("timestamp", args.startTime))
.filter((doc) => doc.timestamp <= args.endTime)

// Expected:
.withIndex("by_sensor_time", (q) => q.eq("sensorId", args.sensorId).gte("timestamp", args.startTime).lte("timestamp", args.endTime))
```

---

### 10. 006-three_level_join (002-queries) -- deploy

**Classification**: MODEL_FAULT

Used `Record<string, string>` instead of `Record<Id<"users">, string>`.

---

### 11. 011-denormalize_pagination (002-queries) -- deploy

**Classification**: KNOWN_GAP

Implemented manual cursor pagination using `_creationTime` instead of `.paginate()`. Documented in GAPS.txt: "Pagination is not working at all. It's trying to make a cursor manually."

---

### 12. 013-async_iterator_filter (002-queries) -- deploy

**Classification**: MODEL_FAULT

Used non-existent `.iter()` method. Convex queries are directly async-iterable: `for await (const x of ctx.db.query("table"))`.

```typescript
// Model (wrong):
const teamsIterator = await ctx.db.query("teams").iter();

// Expected:
for await (const team of ctx.db.query("teams")) { ... }
```

---

### 13. 014-select_distinct (002-queries) -- tests (88%)

**Classification**: MODEL_FAULT

Started query with `.gte("age", 0)`, excluding negative ages. The task requires all distinct ages.

---

### 14. 016-pagination_index (002-queries) -- deploy

**Classification**: MODEL_FAULT

Defined custom `paginationOpts` validator as `v.object({...})` instead of using `paginationOptsValidator` from `convex/server`.

---

### 15. 017-pagination_join (002-queries) -- deploy

**Classification**: KNOWN_GAP

Same pagination opts issue. GAPS.txt: "PaginationOpts are still a custom object, and have cursor as optional vs. nullable."

---

### 16. 018-pagination_returns_validator (002-queries) -- tests (44%)

**Classification**: KNOWN_GAP

Missing `splitCursor` and `pageStatus` in returns validator. Used manual pagination instead of `.paginate()`. Documented in GAPS.txt.

---

### 17. 006-no_storage (003-mutations) -- deploy

**Classification**: KNOWN_GAP

Used `ctx.storage.store()` in a mutation. Storage operations are only available in actions. Documented in GAPS.txt: "Trying to store a file from a mutation."

---

### 18. 000-fetch (004-actions) -- tests (67%)

**Classification**: OVERLY_STRICT

Model added error handling (`if (!response.ok) throw`) which is reasonable defensive coding. A transient 502 from httpbin.org triggered the throw. The model's implementation is correct; the failure is environmental.

**Action taken**: Added retry logic with exponential backoff to the grader test (`fetchWithRetry`, 3 attempts).

---

### 19. 001-run_mutation (004-actions) -- deploy

**Classification**: MODEL_FAULT

Used string literal `"saveFetchResult"` instead of typed `api.index.saveFetchResult` reference.

```typescript
// Model (wrong):
await ctx.runMutation("saveFetchResult", {...});

// Expected:
await ctx.runMutation(api.index.saveFetchResult, {...});
```

---

### 20. 002-run_query_mutation (004-actions) -- deploy

**Classification**: AMBIGUOUS_TASK

Used public `query`/`mutation` instead of `internalQuery`/`internalMutation`. The task doesn't explicitly require internal functions. GAPS.txt acknowledges: "Not using an internal query/mutation, but not really asked to."

---

### 21. 005-storage_http_action (004-actions) -- deploy

**Classification**: KNOWN_GAP

Exported named `httpAction` instead of using `httpRouter()` with default export. Also missing `@types/node` for `process.env` access. Documented in GAPS.txt.

---

### 22. 006-node (004-actions) -- deploy

**Classification**: KNOWN_GAP

Missing `"use node"` directive. Documented in GAPS.txt: "Doesn't know about 'use node'".

---

### 23. 007-http_action_routing (004-actions) -- deploy

**Classification**: KNOWN_GAP

Used Express-style `path: "/api/:path"` instead of Convex's `pathPrefix: "/api/"` for prefix matching. Documented in GAPS.txt.

---

### 24. 000-internal_fns (005-idioms) -- tests (82%)

**Classification**: MODEL_FAULT

Used `action` instead of `internalAction` for `dailyCleanup` that should not be client-accessible. The task clearly states it "should NOT be accessible to clients".

---

### 25. 002-batch_queries (005-idioms) -- deploy

**Classification**: KNOWN_GAP

Used `ctx.runQuery(internal...)` creating subtransactions instead of extracting helper functions. Documented in GAPS.txt.

---

### 26. 000-use_query (006-clients) -- tests (86%)

**Classification**: MODEL_FAULT

Missing `returns` validator on `getAllMessages` query, causing function spec mismatch in the `compareFunctionSpec` test.

---

### 27. 001-use_mutation (006-clients) -- eslint

**Classification**: OVERLY_STRICT (config bug)

Two errors: `'React' is not defined` (no-undef) and `@typescript-eslint/no-misused-promises` on async `onSubmit`. The root cause is that the eslint config targeted `**/*.ts` but NOT `**/*.tsx`, so `.tsx` files got `recommendedTypeChecked` defaults without the custom overrides (e.g. `checksVoidReturn.attributes: false`). The answer code itself has the same async onSubmit pattern and would also fail.

The `'React' is not defined'` error is partly a model fault (using `React.FormEvent` without importing `React`), but the `no-misused-promises` error is purely a config bug.

**Action taken**: Extended eslint config `files` pattern from `["**/*.ts"]` to `["**/*.ts", "**/*.tsx"]` so that all custom rule overrides also apply to TSX files.

---

## Cross-Cutting Patterns

### 1. Fundamental Convex API ignorance (dominant theme)

Without guidelines, Haiku-4.5 doesn't know core Convex patterns:
- `httpRouter()` factory vs `new HttpRouter()` constructor
- `paginationOptsValidator` — reinvents as custom object every time
- `.paginate()` — builds manual cursor pagination instead
- `"use node"` directive — doesn't know it exists
- `pathPrefix` — uses Express-style `:path` params
- `for await` on queries — invents a `.iter()` method
- `api.*` references — uses string literals
- `internalAction`/`internalMutation` — uses public variants when internal needed

This is expected for the no_guidelines experiment.

### 2. Pagination completely broken

5/27 failures involve pagination (#11, #13, #14, #15, #16). The model has no knowledge of `paginationOptsValidator`, `.paginate()`, or the correct returns shape. Largest single cluster.

### 3. Actions vs mutations context confusion

3 failures (#17, #21, #22) from not understanding which operations are available in which context.

### 4. File structure / import case sensitivity

Several failures (#2, #4, #7) from putting code in wrong files or using wrong import casing.

### 5. Comparison with opus

Opus-4-6 scored 83.3% on `default` (with_guidelines). Haiku-4.5 at 57.6% without guidelines shows how much Convex-specific knowledge matters — guidelines account for roughly 25+ percentage points.

### 6. Recurring patterns from opus reports

- **003-crons**: Both models struggle (different root causes)
- **018-pagination_returns_validator**: KNOWN_GAP in both
- **005-storage_http_action**: KNOWN_GAP in both
- **001-use_mutation**: eslint issue in both (now fixed by config change)

## Actions Taken in This Session

1. **ESLint config `files` pattern**: Extended from `["**/*.ts"]` to `["**/*.ts", "**/*.tsx"]` — fixes 001-use_mutation `no-misused-promises` on JSX attributes and ensures all custom rule overrides apply to TSX files too.
2. **httpbin grader retry**: Added `fetchWithRetry()` with 3 attempts and exponential backoff to `004-actions/000-fetch/grader.test.ts` — prevents transient 502s from httpbin.org from failing otherwise-correct models.

## Genuine Model Faults (no action taken)

15 failures are genuine model mistakes where the model doesn't know Convex APIs:
- 002-basic_http_endpoint, 003-crons, 005-function_calling, 008-helper_fns (fundamentals)
- 006-literals, 007-schema_evolution, 010-discriminated_union (data modeling)
- 004-range_condition, 006-three_level_join, 013-async_iterator_filter, 014-select_distinct, 016-pagination_index (queries)
- 001-run_mutation, 000-internal_fns (actions/idioms)
- 000-use_query (clients)

## Known Gaps (no action taken)

9 failures are documented in GAPS.txt:
- 009-returns_validator, 011-denormalize_pagination, 017-pagination_join, 018-pagination_returns_validator
- 006-no_storage, 005-storage_http_action, 006-node, 007-http_action_routing, 002-batch_queries

## Net Impact of Changes

After the eslint config fix and httpbin retry, this run's results would improve from **38/66 (57.6%)** to approximately **40/66 (60.6%)**, with the remaining 25 failures being genuine model faults (15) or known gaps (9) plus 1 ambiguous task.
