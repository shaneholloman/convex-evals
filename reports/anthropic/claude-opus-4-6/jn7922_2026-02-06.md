# Run Analysis: claude-opus-4-6

- **Run ID**: jn7922j1w29pdxm76bj9ps0enx80mg9e
- **Model**: claude-opus-4-6 (anthropic)
- **Experiment**: default (with_guidelines)
- **Date**: 2026-02-06
- **Pass rate**: 54/66 (81.8%)

## Failure Summary

| Step | Count |
|------|-------|
| eslint | 6 |
| deploy (convex dev) | 3 |
| tests | 2 |

## Per-Failure Analysis

### 1. 002-basic_http_endpoint (000-fundamentals) -- tests

**Classification**: OVERLY_STRICT (infrastructure)

Tests failed with raw "fetch failed" network error, not an assertion mismatch. The model's code is functionally correct and nearly identical to the reference answer. Both the GET and POST handlers are properly implemented. This was a connectivity issue between the test runner and the deployed Convex HTTP endpoint.

**Action taken**: Added retry logic with exponential backoff to the grader test.

---

### 2. 003-crons (000-fundamentals) -- deploy

**Classification**: MODEL_FAULT

The model omitted the required empty `{}` args object in `crons.interval()`. The task says to call the action "omitting the argument" (meaning the scheduleDescription), but the model interpreted this as not passing the args parameter at all (3-arg call) instead of passing `{}` (4-arg call).

```typescript
// Model (wrong -- 3 args):
crons.interval("run every second", { seconds: 1 }, internal.crons.emptyAction);

// Expected (correct -- 4 args with empty object):
crons.interval("run every second", { seconds: 1 }, internal.crons.emptyAction, {});
```

---

### 3. 009-normalize_json (001-data_modeling) -- tests

**Classification**: MODEL_FAULT

The model named a field `manager` with type `v.id("employees")` instead of `managerId`. The grader tries `managerId` first (with a real document ID), and if that fails, tries `manager` with a plain string `"Jane"`. The model's schema rejected both: no `managerId` field, and `manager` requires `v.id("employees")` not a string.

```typescript
// Model (inconsistent naming + typing):
manager: v.optional(v.id("employees"))

// Expected:
managerId: v.optional(v.id("employees"))
```

---

### 4. 010-parallel_fetch (002-queries) -- eslint

**Classification**: OVERLY_STRICT

`@typescript-eslint/promise-function-async` on a `.map()` callback. All tests passed. The model's code is functionally correct.

**Action taken**: The `promise-function-async` rule was disabled in a prior commit.

---

### 5. 018-pagination_returns_validator (002-queries) -- deploy

**Classification**: KNOWN_GAP

The model's `pageStatus` validator was missing `v.null()` in the union. The Convex pagination result can have `pageStatus: null` at runtime. GAPS.txt documents pagination validators as a known difficult area.

```typescript
// Model (missing v.null()):
pageStatus: v.optional(v.union(v.literal("SplitRecommended"), v.literal("SplitRequired")))

// Expected:
pageStatus: v.optional(v.union(v.literal("SplitRecommended"), v.literal("SplitRequired"), v.null()))
```

---

### 6. 004-cascade_delete (003-mutations) -- eslint

**Classification**: KNOWN_GAP

`promise-function-async` on `.map()` callback. GAPS.txt explicitly documents this exact issue.

**Action taken**: The `promise-function-async` rule was disabled in a prior commit.

---

### 7. 005-cascade_delete_nested (003-mutations) -- eslint

**Classification**: MODEL_FAULT

The model used `new Set<string>()` to deduplicate IDs, which strips the `Id<T>` type information, forcing `as any` casts when calling `ctx.db.delete()`. This triggers `no-explicit-any` and `no-unsafe-argument`. The reference answer iterates over properly-typed collections directly.

```typescript
// Model (loses type info):
const commentIdsToDelete = new Set<string>();
deletePromises.push(ctx.db.delete(commentId as any));

// Expected (keeps types):
for (const commentId of commentsOnPosts.flat()) {
  await ctx.db.delete(commentId);
}
```

---

### 8. 001-run_mutation (004-actions) -- eslint

**Classification**: KNOWN_GAP

Misplaced `eslint-disable-next-line` directives. GAPS.txt says "The `any` eslint directives are not being added correctly, but that's just a distraction I think."

**Action taken**: Removed the eslint-disable requirement from the task and disabled `no-unsafe-assignment`/`no-unsafe-return` rules.

---

### 9. 002-run_query_mutation (004-actions) -- eslint

**Classification**: MODEL_FAULT (reclassified to resolved)

Misplaced `eslint-disable` directive covering the wrong line. The model's logic was correct (all 9 tests passed).

**Action taken**: Removed the eslint-disable requirement from the task and disabled `no-unsafe-assignment`/`no-unsafe-return` rules.

---

### 10. 005-storage_http_action (004-actions) -- deploy

**Classification**: MODEL_FAULT

The model tried to use `ctx.storage.store()` inside an `internalMutation`, but `storage.store()` is only available in actions (including HTTP actions). The reference answer correctly calls it directly within the `httpAction` handler.

```typescript
// Model (wrong -- storage.store in a mutation):
export const storeFile = internalMutation({
  handler: async (ctx, args) => {
    const storageId = await ctx.storage.store(new Blob([args.blob]));
  },
});

// Expected (correct -- storage.store in an HTTP action):
http.route({
  path: "/store",
  method: "POST",
  handler: httpAction(async (ctx, request) => {
    const storageId = await ctx.storage.store(await request.blob());
  }),
});
```

---

### 11. 001-use_mutation (006-clients) -- eslint

**Classification**: KNOWN_GAP

`no-misused-promises` on async `onSubmit` handler. GAPS.txt documents this. The reference answer itself has the same issue -- both pass an async function to `<form onSubmit={...}>`.

**Action taken**: Configured `no-misused-promises` with `checksVoidReturn: { attributes: false }` to allow async functions in JSX attributes while still catching dangerous cases.

---

## Cross-Cutting Patterns

1. **promise-function-async (2 failures)**: Both fixed by disabling the rule.
2. **eslint-disable placement (2 failures)**: Both fixed by removing the requirement and disabling `no-unsafe-assignment`/`no-unsafe-return`.
3. **async JSX handlers (1 failure)**: Fixed by configuring `no-misused-promises` more leniently for attributes.
4. **Infrastructure flakiness (1 failure)**: Fixed by adding retry logic.

## Genuine Model Faults (no action taken)

- **003-crons**: Needs to learn `crons.interval` requires 4th args argument
- **009-normalize_json**: Field naming inconsistency (`manager` vs `managerId`)
- **005-cascade_delete_nested**: `Set<string>` loses `Id<T>` types, requiring `as any`
- **005-storage_http_action**: `ctx.storage.store()` is action-only, not available in mutations

## Net Impact of Changes

After the eslint config changes and grader improvements applied in this session, this run's results would improve from **54/66 (81.8%)** to approximately **60/66 (90.9%)**, with the remaining 6 failures being genuine model faults or known gaps.
